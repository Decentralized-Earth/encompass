#!/bin/bash
PREFIX="/"

echo ""
echo "Encompass-ELECTRUM_VERSION for Ubuntu-14.04"
echo "by mazaclub - Lead Author, Tyler Willis, release manager, Rob Nelson"
echo ""
echo "based on Electrum, By Thomas Voegtlin"
echo "Requires root privileges, installs Encompass and needed modules"
echo ""
echo "Extracting file into /tmp/Encompass-ELECTRUM_VERSION"
SKIP=`awk '/^__TARFILE_FOLLOWS__/ { print NR + 1; exit 0; }' $0`

#remember our file name
THIS=`pwd`/$0

# take the tarfile and pipe it into tar
tail -n +$SKIP $THIS | tar -C /tmp -xpvz

# Any script here will happen after the tar file extract.
function success (){
 echo "Encompass-ELECTRUM_VERSION is installed to $(which encompass)"
 echo "Remember to save your seeds in a safe place!!" 
 echo "Finished"
 exit 0
}
source /etc/lsb_release
if [ "${DISTRIB_RELEASE}" != "14.04" ] 
then
   echo "Encompass for Ubuntu supports v14.04 only"
   echo "The .deb files have been extracted if you want to try anyway ;)"
   echo "You're recommended to use a source installation:"
   echo "git clone https://github.com/mazaclub/encompass"
   echo "cd encompass"
   echo "git checkout ELECTRUM_VERSION"
   echo "pyrcc4 icons.prc -o gui/qt/icons_qrc.py"
   echo "sudo apt-get install python-qt4 pip"
   echo "sudo pip install --upgrade -r requirements.txt"
   echo "sudo python setup.py install"
   exit 1
fi
if [ "$(uname -p)" != "x86_64" ]
then
   echo "Encompass for Ubuntu supports x86_64 machines only"
   echo "The .deb files have been extracted if you want to try anyway ;)"
   echo "You're recommended to use a source installation:"
   echo "git clone https://github.com/mazaclub/encompass"
   echo "cd encompass"
   echo "git checkout ELECTRUM_VERSION"
   echo "pyrcc4 icons.prc -o gui/qt/icons_qrc.py"
   echo "sudo apt-get install python-qt4 pip"
   echo "sudo pip install --upgrade -r requirements.txt"
   echo "sudo python setup.py install"
   exit 2
fi

echo "Installing Encompass-ELECTRUM_VERSION"
echo ""
cd /tmp/Encompass-ELECTRUM_VERSION
sudo apt-get install -y python-pip python-qt4 \
 && sudo dpkg -i python-ltc-scrypt_1.0-1_HOSTARCH.deb \
 && sudo dpkg -i python-darkcoin-hash_1.1-1_HOSTARCH.deb \
 && sudo dpkg -i python-socksipy-branch_1.01-1_all.deb \
 && sudo apt-get install -y -f \
 && sudo dpkg -i python-encompass_ELECTRUM_VERSION-1_all.deb 
 sudo apt-get install -y -f \
 && sudo dpkg -i python-encompass_ELECTRUM_VERSION-1_all.deb \
 && sudo pip install --upgrade -r requirements.txt \
 && success

echo "Install appears to have failed - please ensure you have root permissions and try again"
exit 1

# NOTE: Don't place any newline characters after the last line below.
__TARFILE_FOLLOWS__
